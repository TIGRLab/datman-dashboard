
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

    <title>Developer Resources &#8212; QC Dashboard 0.0.1 documentation</title>
    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="_static/alabaster.css" />
    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="_static/doctools.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Dashboard API" href="api/modules.html" />
    <link rel="prev" title="Plugins" href="plugins.html" />
   
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="developer-resources">
<h1>Developer Resources<a class="headerlink" href="#developer-resources" title="Permalink to this heading">¶</a></h1>
<p>This page contains additional information that may be useful to anyone
hoping to work on the dashboard’s code.</p>
<p>The app uses a <a class="reference external" href="https://www.postgresql.org/">postgreSQL</a> database and the
front end is programmed in python using the <a class="reference external" href="http://flask.pocoo.org/">Flask</a>
framework. If you’re trying to get familiar with Flask we recommend
<a class="reference external" href="https://blog.miguelgrinberg.com/post/the-flask-mega-tutorial-part-i-hello-world">this tutorial.</a>
We also use <a class="reference external" href="https://www.sqlalchemy.org/">SQLAlchemy</a> to manage the database
models.</p>
<p>Our production web server uses <a class="reference external" href="https://uwsgi-docs.readthedocs.io/en/latest/">uWSGI</a>
behind an <a class="reference external" href="https://www.nginx.com/">NGINX</a> server. Authentication is handled
using <a class="reference external" href="https://en.wikipedia.org/wiki/OAuth">OAuth.</a></p>
<section id="dashboard-structure">
<h2>Dashboard Structure<a class="headerlink" href="#dashboard-structure" title="Permalink to this heading">¶</a></h2>
<p><code class="docutils literal notranslate"><span class="pre">dashboard/models/models.py</span></code> defines the <em>Object Relational Mapping (ORM)</em>
used by SQLAlchemy to map from the relational database to the python objects
used in the code.</p>
<p>All of the ‘views.py’ scripts define the <em>entry points</em> (i.e. valid URLs for
the app). These have been organized into blueprints (<code class="docutils literal notranslate"><span class="pre">dashboard/blueprints</span></code>) that group related
functionality together.</p>
<p>If a blueprint requires any HTML, it is stored inside a ‘templates’ folder
nested within the blueprint. All other HTML templates are in
<code class="docutils literal notranslate"><span class="pre">dashboard/templates/</span></code>. Templates with <cite>_snip.html</cite> or in a ‘snips’ subfolder
are used as reusable pieces embedded in other pages.</p>
</section>
<section id="changing-the-database-schema">
<h2>Changing the Database Schema<a class="headerlink" href="#changing-the-database-schema" title="Permalink to this heading">¶</a></h2>
<p>To keep the database migrations accurate you should:</p>
<ol class="arabic simple">
<li><p>Make changes to models.py and not in the database directly.</p></li>
<li><p>Generate a migrate script with <code class="docutils literal notranslate"><span class="pre">flask</span> <span class="pre">db</span> <span class="pre">migrate</span></code> so others can apply
the changes with a simple <code class="docutils literal notranslate"><span class="pre">flask</span> <span class="pre">db</span> <span class="pre">upgrade</span></code></p></li>
<li><p>Verify that the script generated by <code class="docutils literal notranslate"><span class="pre">flask</span> <span class="pre">db</span> <span class="pre">migrate</span></code> is accurate.
Flask-migrate uses Alembic, which is not capable of reliably detecting
all changes to the schema so manual intervention is sometimes needed.
<a class="reference external" href="https://alembic.sqlalchemy.org/en/latest/autogenerate.html#what-does-autogenerate-detect-and-what-does-it-not-detect">See here</a>
for detailed info on what to look out for.</p></li>
</ol>
</section>
<section id="jinja-template-tips">
<h2>Jinja Template Tips<a class="headerlink" href="#jinja-template-tips" title="Permalink to this heading">¶</a></h2>
<p>Flask’s HTML templates use <a class="reference external" href="https://jinja.palletsprojects.com">Jinja</a>
to render pages. The most important thing to be aware of is that while you can
break up your pages into smaller, more readable, chunks by saving HTML in
another file and then importing it with something like this:</p>
<blockquote>
<div><div class="highlight-jinja notranslate"><div class="highlight"><pre><span></span><span class="cp">{%</span> <span class="k">include</span> <span class="s1">&#39;my_other_file.html&#39;</span> <span class="cp">%}</span>
</pre></div>
</div>
</div></blockquote>
<p>performance-wise, this is not always a good idea. Each and every time the
‘include’ statement is read while the page is constructed, the included
file has to be read from the filesystem. File reads are (relatively) slow and
if the include is inside of a loop with a large number of iterations, you can
easily add extra seconds of load time for a minimal boost in HTML readability.</p>
<dl class="simple">
<dt>Some tips to get the most out of Jinja without adding too much overhead:</dt><dd><ul class="simple">
<li><p>If you have a loop and want to ‘include’ the body of the loop from another
file, it’s better to keep the loop inside the included file (so the file is
opened and read once, rather than once per iteration)</p></li>
<li><p>If you have an ‘if’ statement and the body of it is included from another
snippet, it’s better to keep the ‘if’ in your original file, so you don’t
need to open the snippet just to discover the ‘if’ statement failed</p></li>
</ul>
</dd>
</dl>
<p>Also note that if you’re organizing your HTML snippets in a nested folder, you
always need to give the full path from the root of the template directory to
the file you want to include. If you get an error about a missing template,
make sure you quoted the name of the file to be included.</p>
<blockquote>
<div><div class="highlight-jinja notranslate"><div class="highlight"><pre><span></span><span class="x"># Good</span>
<span class="cp">{%</span> <span class="k">include</span> <span class="s1">&#39;my_snippet.html&#39;</span> <span class="cp">%}</span><span class="x"> # for templates/my_snippet.html</span>
<span class="cp">{%</span> <span class="k">include</span> <span class="s1">&#39;modals/incidental_findings.html&#39;</span> <span class="cp">%}</span><span class="x"> # For templates/modals/incidental_findings.html</span>

<span class="x"># Bad</span>
<span class="cp">{%</span> <span class="k">include</span> <span class="nv">my_snippet.html</span> <span class="cp">%}</span><span class="x"> # Missing quotes on file name</span>
<span class="cp">{%</span> <span class="k">include</span> <span class="s1">&#39;incidental_findings.html&#39;</span> <span class="cp">%}</span><span class="x"> # This file won&#39;t be found without the full path</span>
</pre></div>
</div>
</div></blockquote>
</section>
<section id="sqlalchemy-tips">
<h2>SQLAlchemy Tips<a class="headerlink" href="#sqlalchemy-tips" title="Permalink to this heading">¶</a></h2>
<p>SQLAlchemy is awesome and very powerful BUT sometimes it makes really naive
queries. If you try to work with objects from <code class="docutils literal notranslate"><span class="pre">dashboard.models</span></code> like they’re
normal python objects, you can very easily end up generating thousands of queries
without realizing it. For instance, if you tried doing something like this:</p>
<blockquote>
<div><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">dashboard.models</span> <span class="kn">import</span> <span class="n">Site</span>

<span class="n">cmh</span> <span class="o">=</span> <span class="n">Site</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;CMH&#39;</span><span class="p">)</span>

<span class="k">for</span> <span class="n">timepoint</span> <span class="ow">in</span> <span class="n">cmh</span><span class="o">.</span><span class="n">timepoints</span><span class="p">:</span>
   <span class="c1"># Do some stuff with the timepoint record here</span>
</pre></div>
</div>
</div></blockquote>
<p>This loop would generate one query to the database for each timepoint that has
the site ‘CMH’. If code like that were embedded in a function called in a Jinja
template, then those extra queries would hit every time a user loaded the page.
In these sorts of cases it is often better to craft your own queries using
<a class="reference external" href="http://docs.sqlalchemy.org/en/latest/orm/query.html">SQLAlchemy’s Query API.</a></p>
</section>
<section id="debugging-tips">
<h2>Debugging Tips<a class="headerlink" href="#debugging-tips" title="Permalink to this heading">¶</a></h2>
<ul class="simple">
<li><p>To help with debugging, consider using the <a class="reference external" href="https://flask-debugtoolbar.readthedocs.io/en/latest/index.html">Flask Debug Toolbar.</a>
It can assist in identifying bottlenecks in load time caused by excess querying by giving you a breakdown of your SQLAlchemy queries.</p></li>
</ul>
</section>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="index.html">QC Dashboard</a></h1>








<h3>Navigation</h3>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="configuration.html">Configuration Glossary</a></li>
<li class="toctree-l1"><a class="reference internal" href="menu_conf.html">Menu Configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="plugins.html">Plugins</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Developer Resources</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#dashboard-structure">Dashboard Structure</a></li>
<li class="toctree-l2"><a class="reference internal" href="#changing-the-database-schema">Changing the Database Schema</a></li>
<li class="toctree-l2"><a class="reference internal" href="#jinja-template-tips">Jinja Template Tips</a></li>
<li class="toctree-l2"><a class="reference internal" href="#sqlalchemy-tips">SQLAlchemy Tips</a></li>
<li class="toctree-l2"><a class="reference internal" href="#debugging-tips">Debugging Tips</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="api/modules.html">Dashboard API</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="index.html">Documentation overview</a><ul>
      <li>Previous: <a href="plugins.html" title="previous chapter">Plugins</a></li>
      <li>Next: <a href="api/modules.html" title="next chapter">Dashboard API</a></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2020, TIGRLab.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 5.1.1</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.13</a>
      
      |
      <a href="_sources/developer.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>